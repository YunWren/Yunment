import{d as A,p,ai as E,q as G,h as v,c,o as i,n as b,G as h,w as y,k as M,b as C,Z as _,F as P,B as q}from"./framework.CDCAl0iQ.js";import{R as K}from"./RenderVnode.DYL_MeF_.js";import{i as U,b as W,d as z,_ as Y}from"./Tooltip.vue_vue_type_script_setup_true_lang.NoPgIbAK.js";import{_ as Z}from"./Input.vue_vue_type_script_setup_true_lang.D3h6O4wJ.js";import{_ as k}from"./Icon.vue_vue_type_script_setup_true_lang.DlKVnu5K.js";var J="[object AsyncFunction]",Q="[object Function]",X="[object GeneratorFunction]",ee="[object Proxy]";function F(f){if(!U(f))return!1;var d=W(f);return d==Q||d==X||d==J||d==ee}const le={key:0,class:"yun-select__loading"},te={key:1,class:"yun-select__nodata"},ne={key:2,class:"yun-select__menu"},oe=["id","onClick"],fe=A({name:"YSelect",__name:"Select",props:{modelValue:{},options:{default:()=>[]},placeholder:{},disabled:{type:Boolean},clearable:{type:Boolean},renderLabel:{},filterable:{type:Boolean},filterMethod:{},remote:{type:Boolean},remoteMethod:{}},emits:["change","update:modelValue","visible-change","clear"],setup(f,{emit:d}){const t=f,u=d,g=p(),m=(l=>{const n=t.options.find(o=>(o==null?void 0:o.value)===l);return n||null})(t.modelValue),e=E({inputValue:m?m.label:"",selectedOption:m,mouseHover:!1,loading:!1,highlightIndex:-1}),O=p(),s=p(!1),a=p(t.options);G(()=>t.options,l=>{a.value=l});const w=async l=>{if(t.filterable){if(t.filterMethod&&F(t.filterMethod))a.value=t.filterMethod(l);else if(t.remote&&t.remoteMethod&&F(t.remoteMethod)){e.loading=!0;try{a.value=await t.remoteMethod(l)}catch(n){console.error(n),a.value=[]}finally{e.loading=!1}}else a.value=t.options.filter(n=>n.label.includes(l));e.highlightIndex=-1}},$=v(()=>t.remote?300:0),B=()=>{w(e.inputValue)},D=z(()=>{B()},$.value),R=v(()=>t.filterable&&e.selectedOption&&s.value?e.selectedOption.label:t.placeholder),r=l=>{l?(t.filterable&&e.selectedOption&&(e.inputValue=""),t.filterable&&w(e.inputValue),g.value.show()):(g.value.hide(),t.filterable&&(e.inputValue=e.selectedOption?e.selectedOption.label:""),e.highlightIndex=-1),s.value=l,u("visible-change",l)},j={modifiers:[{name:"offset",options:{offset:[0,9]}},{name:"sameWidth",enabled:!0,fn:({state:l})=>{l.styles.popper.width=`${l.rects.reference.width}px`},phase:"beforeWrite",requires:["computeStyles"]}]},S=()=>{t.disabled||(s.value?r(!1):r(!0))},I=l=>{l.disabled||(e.inputValue=l.label,e.selectedOption=l,u("change",l.value),u("update:modelValue",l.value),r(!1),O.value.ref.focus())},T=v(()=>t.clearable&&e.mouseHover&&e.selectedOption&&e.inputValue.trim()!==""),H=l=>{switch(l.key){case"Enter":s.value?e.highlightIndex>-1&&a.value[e.highlightIndex]?I(a.value[e.highlightIndex]):r(!1):r(!0);break;case"Escape":s.value&&r(!1);break;case"ArrowUp":l.preventDefault(),a.value.length>0&&(e.highlightIndex===-1||e.highlightIndex===0?e.highlightIndex=a.value.length-1:e.highlightIndex--);break;case"ArrowDown":l.preventDefault(),a.value.length>0&&(e.highlightIndex===-1||e.highlightIndex===a.value.length-1?e.highlightIndex=0:e.highlightIndex++);break}},L=()=>{console.log("触发了"),e.selectedOption=null,e.inputValue="",u("clear"),u("change",""),u("update:modelValue","")},N=()=>{};return(l,n)=>(i(),c("div",{class:b(["yun-select",{"is-disabled":l.disabled}]),onClick:S,onMouseenter:n[2]||(n[2]=o=>e.mouseHover=!0),onMouseleave:n[3]||(n[3]=o=>e.mouseHover=!1)},[h(Y,{placement:"bottom-start",ref_key:"tooltipRef",ref:g,manual:"",popperOptions:j,onClickOutside:n[1]||(n[1]=o=>r(!1))},{content:y(()=>[e.loading?(i(),c("div",le,[h(k,{icon:"spinner",spin:""})])):l.filterable&&a.value.length===0?(i(),c("div",te,"no matching data")):(i(),c("ul",ne,[(i(!0),c(P,null,q(a.value,(o,V)=>{var x;return i(),c("li",{key:V,class:b(["yun-select__menu-item",{"is-disabled":o.disabled,"is-selected":((x=e.selectedOption)==null?void 0:x.value)===o.value,"is-highlighted":e.highlightIndex===V}]),id:`select-item-${o.value}`,onClick:_(ie=>I(o),["stop"])},[h(M(K),{vNode:l.renderLabel?l.renderLabel(o):o.label},null,8,["vNode"])],10,oe)}),128))]))]),default:y(()=>[h(Z,{modelValue:e.inputValue,"onUpdate:modelValue":n[0]||(n[0]=o=>e.inputValue=o),disabled:l.disabled,placeholder:R.value,ref_key:"inputRef",ref:O,readonly:!l.filterable||!s.value,onInput:M(D),onKeydown:H},{suffix:y(()=>[T.value?(i(),C(k,{key:0,icon:"circle-xmark",class:"yun-input__clear",onMousedown:_(N,["prevent"]),onClick:_(L,["stop"])})):(i(),C(k,{key:1,icon:"angle-down",class:b(["header-angle",{"is-active":s.value}])},null,8,["class"]))]),_:1},8,["modelValue","disabled","placeholder","readonly","onInput"])]),_:1},512)],34))}});export{fe as _};
